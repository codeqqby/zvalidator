/*! 2015-01-09 | (c) 2014, 2015 guxima@gmail.com */
!function(){"use strict";var a={trim:function(a,b){return a.replace(/^\s+|\s+$/g,b||"")},type:function(a){return Object.prototype.toString.call(a).match(/^\[object\s+([^\]]+)\]$/i)[1].toLowerCase()},each:function(a,b,c){for(var d in a)if(a.hasOwnProperty(d)&&(c?b.call(c,d,a[d]):b(d,a[d]))===!1)break},extend:function(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},$:function(a){return"string"===this.type(a)?document.getElementById(a):a},getChildByTagName:function(a,b){var c,d=[];"array"!==this.type(b)&&(b=[b]);for(var e=0,f=b.length;f>e;)if(c=a.getElementsByTagName(b[e++]),c.length>0)for(var g=0,h=c.length;h>g;g++)d.push(c[g]);return d},arrayFilter:function(a,b){for(var c=[],d=a.length;d--;)b(a[d],d)&&c.push(a[d]);return c},getDataset:function(a,b){return a.dataset?a.dataset[b]:a.getAttribute("data-"+b)},bind:function(a,b){return function(){return a.apply(b,arguments)}},isEmpty:function(b){return this.isNull(b)||this.isUndefined(b)||a.isString(b)&&""===this.trim(b)}};a.each(["Object","Array","Number","String","Boolean","Null","Undefined"],function(a,b){this["is"+b]=function(a){return this.type(a)===b.toLowerCase()}},a);var b=function(){var a={};return{create:function(a){a=a||{};var b=function(){};b.prototype=this;var c=new b;return c.guid=+new Date,c.setErrMsg(a),c},setErrMsg:function(b){var c=this.guid;for(var d in b)b.hasOwnProperty(d)&&(a[c]=a[c]||{},a[c][d.toUpperCase()]=b[d])},getErrMsg:function(b){return b=b.toUpperCase(),a[this.guid]&&a[this.guid][b]}}}(),c={required:function(b){return a.isEmpty(b)?"REQUIRED":!0},numOnly:function(a){return/^[0-9]+$/.test(a)?!0:"NUM_ONLY"},lengthFixed:function(b,c){return a.isEmpty(b)||b.length!==+c?"LENGTH_FIXED":!0},cnCharacterOnly:function(a){return/^[\u4E00-\u9FA5]+$/.test(a)?!0:"CN_CHARACTER_ONLY"},lengthLimit:function(b,c){var d=!0;return!a.isEmpty(b)&&a.isArray(c)&&c.length>0?(a.isUndefined(c[0])||(d=b.length>=c[0]?!0:"LENGTH_LIMIT_MIN"),d!==!0||a.isUndefined(c[1])||(d=b.length<=c[1]?!0:"LENGTH_LIMIT_MAX")):d="LENGTH_LIMIT_UNKNOWN",d}},d={rangeLimit:{deps:["numOnly"],check:function(b,c){if(a.isArray(c)&&2===c.length){var d=!0;return b=parseInt(b,10)||0,"undefined"!==a.type(c[0])&&(d=b>=parseInt(c[0],10)?!0:"RANGE_LIMIT_MIN"),d===!0&&"undefined"!==a.type(c[1])&&(d=b<=parseInt(c[1],10)?!0:"RANGE_LIMIT_MAX"),d}}},cellphoneNo:{deps:["numOnly",["lengthFixed",11]],check:function(a){return/^1[0-9]{10}$/.test(a)?!0:"CELLPHONENO_INVALID"}},IDCardNo:{deps:[["lengthFixed",18]],check:function(a){var b=!0;if(/^\d{17}[\dX]$/gi.test(a)){for(var c=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],d=17,e=0;d--;)e+=a[d]*c[d];e=(12-e%11)%11,10===e&&(e="X"),e!=a.slice(-1).toUpperCase()&&(b="IDCARDNO_INVALID")}else b="IDCARDNO_UNEXPECT_CHAR";return b}}},e=function(b,c){var d={create:function(){var a=function(){};a.prototype=this;var b=new a;return b.depValidatorQueue=[],b},depend:function(a){for(var b=a.length;b--;)this.depValidatorQueue.unshift(a[b])},decorate:function(){function d(d,e){var f=!0;return a.each(this.depValidatorQueue,function(e,g){var h=g,i=[];a.isArray(g)&&(h=g[0],i=g.slice(1));var j=(0===i.length?[h,d]:[h,d].concat(i),c[h]||b[h]);return f=j?j(d,i):!0,"undefined"!==a.type(f)&&f!==!0?!1:void 0},this),f="undefined"===a.type(f)||f===!0?this.check(d,e):this.constrName+"_"+f}return function(b,c){return this.constrName=b,a.isArray(c.deps)&&c.deps.length>0&&this.depend(c.deps),(this.check=c.check)?function(){return d.apply(this,arguments)}:void 0}}()};return a.each(c,function(b,e){var f=d.create();c[b]=a.bind(f.decorate(b,e),f)}),{factory:d,basic:b,advance:c}}(c,d),f=function(){var a={};return{setLangConf:function(b,c){a[b]=c},getConfByLang:function(b){return b=b||("undefined"!=typeof window?(navigator.language||navigator.userLanguage).toLowerCase():"zh-cn"),a[b]||null}}}();f.setLangConf("zh-cn",{UNKNOWN:"未知错误",REQUIRED:"不能为空",CN_CHARACTER_ONLY:"只能为汉字",NUM_ONLY:"只能为数字",LENGTH_FIXED:"长度和限定长度不一致",LENGTH_LIMIT_MIN:"长度小于最小长度",LENGTH_LIMIT_MAX:"长度大于最大长度",LENGTH_LIMIT_UNKNOWN:"未知的长度限制错误",RANGE_LIMIT_MIN:"值小于最小限制",RANGE_LIMIT_MAX:"值大于最大限制",CELLPHONENO_INVALID:"手机号不符合要求",IDCARDNO_UNEXPECT_CHAR:"身份证号码中有不能识别的字符",IDCARDNO_INVALID:"身份证信息错误"}),f.setLangConf("en-us",{UNKNOWN:"未知错误",NOT_NULL:"不能为空",CN_CHARACTER_ONLY:"只能为汉字",NUM_ONLY:"只能为数字",LENGTH_FIXED:"长度和限定长度不一致",LENGTH_LIMIT_MIN:"长度小于最小长度",LENGTH_LIMIT_MAX:"长度大于最大长度",RANGE_LIMIT_MIN:"值小于最小限制",RANGE_LIMIT_MAX:"值大于最大限制",CELLPHONENO_INVALID:"手机号不符合要求",IDCARDNO_UNEXPECT_CHAR:"身份证号码中有不能识别的字符",IDCARDNO_INVALID:"身份证信息错误"}),window.ZValidator=function(){var c=e.factory,d=a.extend(e.basic,e.advance),g=f.getConfByLang();return{create:function(d){d=d||{};var e=function(){};e.prototype=this;var f=new e,h=f.validator||(f.validator={});f.errorSet=b.create(g),d.onValid&&(f.onValid=d.onValid,delete d.onValid),d.onInvalid&&(f.onInvalid=d.onInvalid,delete d.onInvalid);for(var i in d)if(d.hasOwnProperty(i)&&"function"==typeof d[i].check){var j=c.create();h[i]=a.bind(j.decorate(i,d[i]),j)}return f},setErrorMsg:function(a){return this.errorSet.setErrMsg(a),this},applyValidator:function(a,b,c){var e=!0,f=this.validator[a]||d[a];return f?e=f.call(this,b,c):(console.log("invalid validator name => "+a),e="UNKNOWN"),e},traverseContainer:function(b){var b=a.$(b),c=!0,d=this,e="validator",f=a.getChildByTagName(b,["input","select","textarea"]);return a.each(a.arrayFilter(f,function(b){return!!a.getDataset(b,e)}),function(b,f){var g={},h=a.getDataset(f,e);try{g=new Function("return "+h)()}catch(i){throw"invalid data-validator values => "+h}return a.each(g,function(b,e){var h,i=e;a.isObject(g)?(i=b,h=e):a.isArray(e)&&(i=e[0],h=e.slice(1));var j=d.applyValidator(i,a.trim(a.$(f).value),h);return j&&j!==!0?(j=j.toUpperCase(),c={code:j,msg:d.errorSet.getErrMsg(j)||d.errorSet.getErrMsg(j.slice(j.indexOf("_")+1)),validatorName:i,element:f},!1):void 0}),c===!0}),c===!0?this.onValid&&this.onValid():this.onInvalid&&this.onInvalid(c)||c}}}()}();